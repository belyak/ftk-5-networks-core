ОПИСАНИЕ ПРОТОКОЛА
==================

Протокол предназначен для для общения с сервером частотного анализа текстов. 
Клиент может передавать тексты и получать статистические данные по ним, вычисления осуществляются сервером.
Протокол реализован по принципу вопрос-ответ.

Соглашения и терминология.
==========================
UPI - user protocol interpreter - интерпретатор протокола на стороне пользователя - программа, извлекающая информацию
      из ответов сервера, может отсутствовать при подключении пользователя по протоколу telnet.

Процедура установления соединения (handshake)
=============================================


Формат ответа сервера
=====================

Ответ сервера реализован подобно ответу сервера в протоколе ftp (rfc959) и состоит из кода ответа и текстового
сообщения.

коды ответов
============

200 - ОК - команда выполнена нормально
400 - Bad Data - неверный формат запроса (команды)
401 - Unauthorized - для выполнения данного запроса необходимо авторизоваться
403 - Permission Denied - выполнение данного действия невозможно (не хватает прав)

формат однострочного ответа сервера:
<code> <text_message><CR>

например:
200 Status OK.

формат многострочного ответа сервера:

<code>-<first_line><CR>
<second_line><CR>
...
<code> <last_line><CR>


например:

200-Stats:
lines 456
200 encoding UTF-8


Формат команд.
--------------

Каждая команда состоит собственно из команды и дополнительных аргументов, если таковые требуются.
Все команды состоят из первых 127 символов кодировки ascii и сервер воспринимает команды нечувствительно к регистру.
Команда заканчивается символом переноса строки <CR>.
В качестве разделителя команды и агрументов используется пробел.
Для команд, требующих передачи нескольких строк данных на сервер, команда предусматривает передачу клиентом
последовательности окончания данных (клиент должен сам сгенерировать ее, так, чтобы она не встретилась в данных)
разделитель всегда является последним аргументом команды и заканчивается переносом строки.
Если команда предполагает передачу на сервер одной строки, то строка является последним аргументом команды и 
разделитель аргументов внутри строки не трактуется сервером как разделитель. Такая передаваемая на сервер строка
строка указана в формате команд как <line>.

общий формат команды, содержащей многострочные данные:

<command> <argument_1> <argument_2> ... <argument_separator><CR>
<data_line_1><CR>
<data_line_2><CR>
...
<last_data_line><CR>
<argument_separator><CR>

например:

pt pacman
Humpty Dumpty sat on the wall,
Humpty Dumpty had a great fall.
All the King's horses and all the King's man
Couldn't put Humpty together again.
pacman

Описание команд
---------------

Все команды делятся на однострочные и многострочные, в случае многострочной команды в ее описании последним аргументом
является разделитель названный в описании по-английски как <separator>. Все команды заканчиваются переносом строки <CR>,
который в нижеследующем описании форматов команд опущен.

clear
-----
Очистить буффер текста

CLEAR

pl
--
Отправить одну строку.

PT <line>

pt
--
Отправить текст

PT <separator>

enc
---
Установить кодировку для текста

ENC <encoding_name>

<encoding_name> - название кодировки, в которой будут передаваться не ascii символы в запросах и ответах команд PL, PT
и PS.

calc
----
Посчитать статистику по тексту в буффере

CALC

ps
--
Получить посчитанную статистику по тексту

PS

Команда предполагает многострочный ответ сервера.
Первая строка ответа анлийское слово STATISTICS, затем следуют статистики использования слова по одной на каждой строке:

например:

200-STATISTICS
Humpty 3
King 2
200 Dumpty 3


Сводное описание команд и ответов сервера
=========================================

+---------------+-----------------------------------------------------------------------------------------------------+
| Команда       |          Возможные ответы сервера                                                                   |
|               +--------+-----------------+--------------------------------------------------------------------------+
|               | код    | информативность | описание содержания сообщения                                            |
|               | ответа |                 | сообщения                                                                |                                                                   |
|               |        | P / H / C  (*)  |                                                                          |
+---------------+--------+-----------------+--------------------------------------------------------------------------+
| ver           | 200    | C               | Версия сервера в виде десятичного числа                                  |
|               |        |                 |                                                                          |
| exit          | 200    | P               | Строка `Goodbye!`                                                        |
|               |        |                 |                                                                          |
| pl <line>     | 200    | H               | Строка `line has been collected (%d at the moment).`                     |
|               |        |                 |                                                                          |
|               |        |                 |                                                                          |
| pt            |        | H               | Строка `%d lines has been collected (%d total)`                          |
|               |        |                 |                                                                          |
| enc <name>    | 200    | H               | Строка `Encoding has been set to "%s"`                                   |
|               | 404    | H               | Строка `encoding "%s" not found!`                                        |
|               |        |                 |                                                                          |
| calc          | 200    | H               | Строка `'Calculated (%d lines, %d words)'`                               |
|               |        |                 |                                                                          |
| ps            | 200    | C               | Сообщение содержит распечатку текущей статистики, статистика начинается  |
|               |        |                 | со строки с ключевым словом "STATISTICS" за которой следуют найденные    |
|               |        |                 | в тексте слова (WORD) с количеством вхождений (COUNT), по одному на      |
|               |        |                 | каждой строке:                                                           |
|               |        |                 |                                                                          |
|               |        |                 |     message = header-keyword statistics                                  |
|               |        |                 |     header-keyword = "STATISTICS"                                        |
|               |        |                 |     statistics = statistics-line [statistics]                            |
|               |        |                 |     statistics-line = WORD " " DECIMAL                                   |
|               |        |                 |                                                                          |
|               |        |                 |                                                                          |
| ld <name>     | 200    | H               | Строка `Statistics "%s" has been loaded.`                                |
|               | 404    | H               | Строка `Statistics "%s" not found!`                                      |
|               |        |                 |                                                                          |
|               |        |                 |                                                                          |
| st <name>     | 200    | P               | Строка `Statistics "%s" has been saved`                                  |
|               |        |                 |                                                                          |
+---------------+--------+-----------------+--------------------------------------------------------------------------+

(*) Информативность сообщения:
    P - predefined - сообщение является предопределенным (описанием протокола либо настройками сервера),
        и всегда возвращается определенным сервером всместе с указанным в таблице кодом ответа.

    H - human addressed - сообщение содержит информацию предназначенную для человека и носящую вспомогательный характер.
        UPI не должен извлекать эту информацию.

    C - computer addressed - сообщение содержит информацию которая должна быть извлечена UPI.